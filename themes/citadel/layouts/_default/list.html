{{ define "main" }}

<div class="container-xl p-3 p-md-6 width-full">

    <!-- main header (hamburger + breadcrumbs) now rendered globally in base layout -->

    <div class="markdown-body">
        <div class="mt-3">
            <h1 class="border-bottom-0">{{ .Title }}</h1>
        </div>
        {{ with .Description }}<p>{{ . }}</p>{{ end }}
        {{ .Content }}
    </div>

    {{ $pages := .Pages.ByWeight }}
    {{ if and (eq .Section "archive") (eq .RelPermalink "/archive/") }}
        {{ $pages = .Pages.ByTitle }}
    {{ end }}
    {{ if gt (len $pages) 0 }}
    <section class="mt-4" aria-label="{{ .Title }} items">
        <div class="d-flex flex-column" role="list">
            {{ range $pages }}
            <article class="section-tile tile-hover-accent box Box-row--hover-gray p-3 mb-3 mt-0 position-relative" role="listitem">
                <a class="stretched-link d-block text-decoration-none" href="{{ .Permalink }}" aria-label="Open: {{ .Title }}"></a>
                <h3 class="f4 lh-condensed mt-0 mb-2">{{ .Title }}</h3>
                {{ if eq .Section "blog" }}
                <div class="f6 text-gray mb-1">
                    {{ with .Params.people }}
                        {{ $author := index . 0 }}<span>{{ $author }}</span>
                    {{ end }}
                    {{ if and (.Date) (ne .Date.IsZero true) }}
                        {{ if .Params.people }} &bull; {{ end }}
                        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "02 Jan 2006" }}</time>
                    {{ end }}
                </div>
                {{ end }}
                <div class="summary f5">
                    {{ if .Description }}
                        <p class="mb-0">{{ .Description }}</p>
                    {{ else }}
                        {{ $paras := findRE "<p>[\\s\\S]*?</p>" .Content 1 }}
                        {{ if gt (len $paras) 0 }}{{ index $paras 0 | safeHTML }}{{ else }}<p class="mb-0">{{ .Summary }}</p>{{ end }}
                    {{ end }}
                </div>
            </article>
            {{ end }}
        </div>
    </section>
    {{ end }}
</div>

{{ end }}