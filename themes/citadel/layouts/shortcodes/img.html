{{/*
GitHub-style responsive images for light/dark themes.
Works with both system preference and manual theme toggle.
*/}}

{{ $dark := .Get "dark" }}
{{ $light := .Get "light" }}
{{ $src := .Get "src" }}
{{ $alt := .Get "alt" }}
{{ $class := .Get "class" }}

{{ $fallbackSrc := $src }}
{{ if not $fallbackSrc }}
  {{ $fallbackSrc = $light | default $dark }}
{{ end }}

<p class="theme-responsive-image">
  <picture>
    {{ with $dark }}
    <source media="(prefers-color-scheme: dark)" srcset="{{ $dark }}" data-dark-src="{{ $dark }}">{{ end }}
    {{ with $light }}
    <source media="(prefers-color-scheme: light)" srcset="{{ $light }}" data-light-src="{{ $light }}">{{ end }}
    <img
      alt="{{ $alt }}"
      src="{{ $fallbackSrc }}"
      {{ with $light }}data-light-src="{{ . }}"{{ end }}
      {{ with $dark }}data-dark-src="{{ . }}"{{ end }}
      {{ with $class }}class="{{ . }}"{{ end }}
      data-theme-responsive="true">
  </picture>
</p>