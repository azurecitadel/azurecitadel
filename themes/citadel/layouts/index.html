{{ define "main" }}

<section id="landing">
	<div class="container-xl">
		<div class="d-lg-flex flex-row-reverse flex-items-center">
			<img class="width-full" alt="Azure Citadel Logo" src="{{ `default-og-image.png` | absURL }}" />
		</div>
	</div>
</section>

<div class="container-xl px-3 px-md-6 my-4">

	{{.Site.Home.Content}}

	{{/* Categories section removed as requested */}}

	<section class="frontpage-categories mt-4" aria-label="Topic categories">
		<h2 class="h3 mb-2">Explore Topics</h2>
		{{/* Dynamically derived from side menu (exclude About, Archive, Blog) */}}
		{{ $all := .Site.Menus.side }}
		{{ $exclude := slice "About" "Archive" "Blog" }}
		{{ $topics := where $all "Name" "not in" $exclude }}
		<div class="frontpage-grid" role="list">
			{{ range $topics }}
			<div class="frontpage-tile tile-hover-accent box Box-row--hover-gray p-2 position-relative" role="listitem">
				<a class="stretched-link text-decoration-none" href="{{ .URL }}" aria-label="Go to {{ .Name }}"></a>
				<span class="tile-title d-block">{{ .Name }}</span>
			</div>
			{{ end }}
		</div>
	</section>

	{{/* Blog summary section (moved below topics) */}}
	{{ $blogSection := where .Site.RegularPages "Section" "blog" }}
	{{ if gt (len $blogSection) 0 }}
	<section class="mt-5" aria-label="Latest blog posts">
		<h2 class="h3 mb-3">Latest Blog Posts</h2>
		<div class="blog-summaries">
		{{ range first 3 (sort $blogSection "Date" "desc") }}
			<article class="blog-summary tile-hover-accent box Box-row--hover-gray p-3 mb-3 position-relative" itemscope itemtype="https://schema.org/BlogPosting">
				<a class="stretched-link d-block text-decoration-none" href="{{ .Permalink }}" itemprop="url" aria-label="Read: {{ .Title }}"></a>
				<header class="mb-2">
					<h3 class="f3 lh-condensed mt-0 mb-1" itemprop="headline">{{ .Title }}</h3>
					<div class="meta f6 text-gray" itemprop="author" itemscope itemtype="https://schema.org/Person">
						{{ with .Params.people }}
							{{ $author := index . 0 }}
							<span itemprop="name">{{ $author }}</span>
						{{ end }}
						&bull;
						<time datetime="{{ .Date.Format "2006-01-02" }}" itemprop="datePublished">{{ .Date.Format "02 Jan 2006" }}</time>
					</div>
				</header>
				<div class="summary" itemprop="description">
					{{ $paras := findRE "<p>[\\s\\S]*?</p>" .Content 1 }}
					{{ if gt (len $paras) 0 }}{{ index $paras 0 | safeHTML }}{{ else }}<p>{{ .Summary }}</p>{{ end }}
				</div>
			</article>
		{{ end }}
		</div>
		<p class="f6"><a href="/blog/">View all blog posts â†’</a></p>
	</section>
	{{ end }}
</div>

<script>
	(async function () {
		const { text } = await (await fetch(`/api/message`)).json();
		document.querySelector('#name').textContent = text;
	}());
// (Removed iframe resize listener)
</script>

{{ end }}